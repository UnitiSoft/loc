import{i as t,a as e,b as n}from"./p-565580e1.js";import{g as o}from"./p-ac07b196.js";const r=({feature:t,separator:e,type:n,path:o})=>{switch(n){case"memory":return w(t+e+(o||""));case"local":const n=JSON.parse(localStorage.getItem(t));return o?w(o,n,e):n;case"session":const r=JSON.parse(sessionStorage.getItem(t));return o?w(o,r,e):r;default:return w(t+e+o)}},c=(t,e,n,o)=>{const r=t.path?l(t.path.split(t.separator),e):e;switch(t.type){case"memory":s(t,r,n,o,e);break;case"local":const c=JSON.parse(localStorage.getItem(t.feature))||{};localStorage.setItem(t.feature,JSON.stringify(a(n,o,c,r,e)));break;case"session":let i=JSON.parse(sessionStorage.getItem(t.feature))||{};sessionStorage.setItem(t.feature,JSON.stringify(a(n,o,i,r,e)));break;default:s(t,r,n,o,e)}};function a(t,e,n,o,r){return t?f(n,o):d(n,o,e,r)}function s(t,e,n,o,r){i(t.feature.split(t.separator),window.top);const c=u(t.feature.split(t.separator),window.top);i(t.feature.split(t.separator),window.top,n?f(c,e):d(c,e,o,r))}function i(t,e,n){const o=t.shift();e[o]=e[o]||{},t.length>0?i(t,e[o],n):e[o]=n||e[o]}function u(t,e){const n=t.shift();return t.length>0?u(t,e[n]):e[n]}function l(t,e){const n=t.shift();return t.length>0?{[n]:l(t,e)}:{[n]:e}}function f(t,e){const o=Object.assign({},t);return Object.keys(e).forEach((r=>{o[r]=r in t?n(t[r])&&n(e[r])?f(t[r],e[r]):t[r]:e[r]})),o}function d(t,e,o,r){const c=Object.assign({},t);return Object.keys(e).forEach((a=>{c[a]=!(a in t)||!n(e[a])||o&&e[a]===r?e[a]:d(t[a],e[a],o,r)})),c}function w(t,e=window.top,n="."){return(Array.isArray(t)?t:t.split(n)).reduce(((t,e)=>t&&t[e]),e)}function S(t,e,n){const o=e?n?t.querySelectorAll(e):[t.querySelector(e)]:t.children;return o&&o[0]||(console.error("No Element target: "+e),console.warn("for Element",t)),o}const p={toggle:t=>!r(t),increment:(t,e)=>{const n=r(t);return(100*o(n)+100*e.state)/100},decrement:(t,e)=>{const n=r(t);return(100*o(n)-100*e.state)/100},getLink:t=>t.$event.target.pathname||function(t){let e="";return Array.from(t).some((t=>(e=t.pathname||"",!!t.pathname))),e}(t.$event.path)};function O({feature:e,separator:n,type:c,path:a},{el:s,all:i,equal:u,noEqual:l,target:f,prop:d,value:w}){const S=r({feature:e,separator:n,type:c,path:a}),p=t(u)&&S===o(u)||t(l)&&S!==o(l),O=t(w)?t(u)||t(l)?p?b(w):void 0:b(w):t(u)||t(l)?p:S,m=JSON.parse(localStorage.getItem("uniStoreDebug"));m&&m[c]&&m[c].includes("listen")&&console.log("%cSTORE LISTEN:","color: darkorange; font-weight: bold",{type:c,feature:e,path:a,prop:d,val:O,element:s}),g(s,d,O,f,i)}function b(t){return e(t)?JSON.parse(t):t}function g(t,e,n,o,r){Array.from(S(t,o,r)).forEach((t=>{t&&(t[e]=n)}))}function m(t){return t.feature+t.separator+t.type+(t.path?t.separator+t.path:"")}function v(t,e,o){c(t,o,e.init,e.clean);const a=JSON.parse(localStorage.getItem("uniStoreDebug"));a&&a[t.type]&&a[t.type].includes("set")&&function(t,e){const n=r(t);console.log("%cSTORE SET:","color: darkred; font-weight: bold",Object.assign(Object.assign(Object.assign({},t),e),{value:n,$event:void 0}))}(t,e),setTimeout((()=>{const r=window.top.document.body.querySelectorAll(e.dispatch);y(r,t,o),n(o)&&j(r,m(t),t.separator,o),function(t,e,o){const r=window.top.document.body.querySelectorAll("iframe");r.length>0&&Array.from(r||[]).forEach((r=>{var c,a;const s=null===(a=null===(c=r.contentDocument)||void 0===c?void 0:c.body)||void 0===a?void 0:a.querySelectorAll(t.dispatch);y(s,e,o),n(o)&&j(s,m(e),e.separator,o)}))}(e,t,o)}))}function y(t,e,n){const o=m(e);Array.from(t||[]).forEach((t=>{t.dispatchEvent(new CustomEvent(o,{detail:n}))})),window.top.dispatchEvent(new CustomEvent(o,{detail:n}));const c=Object.assign({},e),a=e.path.split(".");a.pop(),a.length>0&&(c.path=a.join("."),y(t,c,r(c)))}function j(t,e,o,r){for(let[c,a]of Object.entries(r)){const r=e+o+c;n(a)&&j(t,r,o,a),Array.from(t||[]).forEach((t=>{t.dispatchEvent(new CustomEvent(r,{detail:a}))})),window.top.dispatchEvent(new CustomEvent(r,{detail:a}))}}export{p as U,m as a,v as b,S as c,O as d,g as u}